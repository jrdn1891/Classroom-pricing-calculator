<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goodnotes Classroom Pricing Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #45BFDB; /* Goodnotes teal color */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 40px;
            height: 100vh;
            margin: 0;
            color: #333;
        }
        .container {
            background: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 800px;
            margin-bottom: 20px;
        }
        .pricing-title {
            text-align: center;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }
        p {
            font-size: 18px;
            margin: 10px 0;
        }
        input[type=range] {
            width: 100%;
            margin: 20px 0;
            cursor: pointer;
        }
        .price {
            font-size: 32px;
            font-weight: bold;
            margin-top: 20px;
            color: #007AFF;
        }
        .price-label {
            font-size: 32px;
            font-weight: bold;
        }
        .price span {
            font-size: 20px;
            font-weight: normal;
        }
        .contact-message {
            font-size: 22px;
            font-weight: 600;
            margin-top: 20px;
            color: #ff5722;
        }
        .contact-message a {
            color: #ff5722;
            text-decoration: underline;
        }
        .button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 500;
            background-color: #007AFF;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .settings-container {
            display: none;
            margin-top: 20px;
            background: #f9f9f9;
            padding: 20px;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            text-align: center;
        }
        .settings-container label {
            font-size: 18px;
            font-weight: 500;
            margin-right: 10px;
        }
        .settings-input {
            width: 80px;
            padding: 6px;
            font-size: 16px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 10px 20px 10px;
        }
        .breakpoints-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .breakpoints-table th, .breakpoints-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .breakpoints-table th {
            background: #f1f1f1;
            font-weight: 600;
        }
        .breakpoints-table td {
            background: #ffffff;
        }
        .button-add-breakpoint {
            background-color: #28a745;
            color: #fff;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        .button-remove {
            background-color: #ff4d4d;
            color: #fff;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pricing-title">
            <h1>Goodnotes Classroom Pricing Calculator</h1>
            <p>Number of student seats: <span id="seatCount">100</span> seats</p>
            <input type="range" id="seatSlider" min="0" max="2050" value="100" step="10">
            <div class="price-label">Total Price: <span class="price" id="totalPrice">$500</span> <span>per year</span></div>
            <div class="contact-message" id="contactMessage" style="display: none;">
                Need more than 2000 seats? <a href="#">Contact us</a> to get a quote.
            </div>
        </div>

        <button class="button" id="toggleSettings">Show Advanced Settings</button>

        <div class="settings-container" id="settingsContainer">
            <label for="startingPrice">Starting Price ($): </label>
            <input type="number" id="startingPrice" class="settings-input" value="5" step="0.01" min="0">
            
            <label for="defaultDiscount">Default Discount for Tiers (%): </label>
            <input type="number" id="defaultDiscount" class="settings-input" value="20" min="0" max="100">

            <h2>Breakpoint Modifiers</h2>
            <table class="breakpoints-table">
                <thead>
                    <tr>
                        <th>Tier Number</th>
                        <th>Discount (%)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="breakpointsTableBody">
                    <!-- Breakpoints will be dynamically added here -->
                </tbody>
            </table>
            <button class="button-add-breakpoint" id="addBreakpointButton">Add Breakpoint</button>
        </div>
    </div>

    <script>
        const seatSlider = document.getElementById('seatSlider');
        const seatCount = document.getElementById('seatCount');
        const totalPriceElement = document.getElementById('totalPrice');
        const contactMessage = document.getElementById('contactMessage');
        const startingPriceInput = document.getElementById('startingPrice');
        const defaultDiscountInput = document.getElementById('defaultDiscount');
        const settingsContainer = document.getElementById('settingsContainer');
        const toggleSettingsButton = document.getElementById('toggleSettings');
        const addBreakpointButton = document.getElementById('addBreakpointButton');
        const breakpointsTableBody = document.getElementById('breakpointsTableBody');

        let breakpoints = []; // Store breakpoints dynamically

        // Function to calculate price based on discount logic and breakpoints
        function calculatePrice(seats) {
            let price = 0;
            let remainingSeats = seats;
            let pricePerSeat = parseFloat(startingPriceInput.value);  // Use starting price
            let tierSize = 100;

            // Sort breakpoints to ensure correct application order
            const sortedBreakpoints = breakpoints.sort((a, b) => a.tierNumber - b.tierNumber);

            let currentDiscount = parseFloat(defaultDiscountInput.value) / 100;

            // Apply discount and breakpoints for each tier
            for (let tier = 1; remainingSeats > 0; tier++) {
                const seatsInTier = Math.min(tierSize, remainingSeats);
                price += seatsInTier * pricePerSeat;
                remainingSeats -= seatsInTier;

                // Check if a custom discount breakpoint is set for this tier
                const breakpoint = sortedBreakpoints.find(bp => bp.tierNumber === tier);
                if (breakpoint) {
                    currentDiscount = breakpoint.discount / 100; // Overwrite with breakpoint discount
                }
                // Apply the current discount
                pricePerSeat = pricePerSeat * (1 - currentDiscount);
            }

            return price.toFixed(2);
        }

        // Function to update price display
        function updatePrice() {
            const seats = parseInt(seatSlider.value);
            seatCount.textContent = seats;

            if (seats > 2000) {
                totalPriceElement.style.display = ''
                                totalPriceElement.style.display = 'none';
                contactMessage.style.display = 'block';
            } else {
                contactMessage.style.display = 'none';
                totalPriceElement.style.display = 'inline';
                totalPriceElement.textContent = `$${calculatePrice(seats)}`;
            }
        }

        // Toggle visibility of advanced settings section
        toggleSettingsButton.addEventListener('click', () => {
            if (settingsContainer.style.display === 'none' || settingsContainer.style.display === '') {
                settingsContainer.style.display = 'block';
                toggleSettingsButton.textContent = 'Hide Advanced Settings';
            } else {
                settingsContainer.style.display = 'none';
                toggleSettingsButton.textContent = 'Show Advanced Settings';
            }
        });

        // Function to add a new breakpoint row
        function addBreakpointRow(tierNumber = 1, discount = 15) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="number" class="settings-input" value="${tierNumber}" min="1" step="1" data-tier="number"></td>
                <td><input type="number" class="settings-input" value="${discount}" min="0" step="0.1" data-tier="discount"></td>
                <td><button class="button-remove" onclick="removeBreakpointRow(this)">Remove</button></td>
            `;
            breakpointsTableBody.appendChild(row);

            // Attach event listeners to the newly created inputs
            row.querySelector('[data-tier="number"]').addEventListener('input', updateBreakpoint);
            row.querySelector('[data-tier="discount"]').addEventListener('input', updateBreakpoint);
        }

        // Function to update the breakpoint values in the breakpoints array
        function updateBreakpoint(event) {
            const row = event.target.closest('tr');
            const tierNumber = parseInt(row.querySelector('[data-tier="number"]').value);
            const discount = parseFloat(row.querySelector('[data-tier="discount"]').value);

            // Check if the breakpoint already exists, if so, update it
            const existingBreakpoint = breakpoints.find(bp => bp.tierNumber === tierNumber);
            if (existingBreakpoint) {
                existingBreakpoint.discount = discount;
            } else {
                // If the breakpoint does not exist, add a new one
                breakpoints.push({ tierNumber, discount });
            }

            updatePrice(); // Update price calculation based on new breakpoints
        }

        // Function to remove a breakpoint row
        function removeBreakpointRow(button) {
            const row = button.closest('tr');
            const tierNumber = parseInt(row.querySelector('[data-tier="number"]').value);

            // Remove the breakpoint from the array
            breakpoints = breakpoints.filter(bp => bp.tierNumber !== tierNumber);
            row.remove();

            updatePrice(); // Update price calculation based on removed breakpoints
        }

        // Event listener for adding a new breakpoint
        addBreakpointButton.addEventListener('click', () => {
            // By default, add a new row with the next tier number and a 15% discount
            const nextTierNumber = breakpoints.length > 0 ? Math.max(...breakpoints.map(bp => bp.tierNumber)) + 1 : 1;
            addBreakpointRow(nextTierNumber, 15);
        });

        // Attach event listeners to update price dynamically
        seatSlider.addEventListener('input', updatePrice);
        startingPriceInput.addEventListener('input', updatePrice);
        defaultDiscountInput.addEventListener('input', updatePrice);

        // Initial price calculation on page load
        updatePrice();
    </script>
</body>
</html>